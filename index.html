<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Acuerdos | Servicio al Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS es idéntico al de la Opción 1, no hay cambios aquí */
        :root { --primary-color: #004E98; --secondary-color: #FFB703; --danger-color: #8a3d3d; --background-color: #0A1929; --card-background: #112233; --text-color: #E0E0E0; --border-color: #303E4D; }
        body { background-color: var(--background-color); color: var(--text-color); font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; min-height: 100vh; box-sizing: border-box; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        header h1 { font-family: 'Orbitron', sans-serif; color: var(--text-color); font-size: 2.5rem; }
        header h1 span { color: var(--primary-color); text-shadow: 0 0 8px rgba(0, 78, 152, 0.7); }
        .container { width: 90%; max-width: 1400px; margin: 0 auto; flex: 1; }
        .controls-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        #search { width: 100%; max-width: 500px; padding: 15px; background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); font-size: 1rem; outline: none; transition: all 0.3s ease; }
        #search:focus { border-color: var(--secondary-color); box-shadow: 0 0 15px rgba(255, 183, 3, 0.3); }
        .export-btn { padding: 15px 25px; background-color: var(--secondary-color); color: var(--background-color); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: all 0.3s ease; }
        .export-btn:hover { background-color: #ffca43; transform: translateY(-2px); }
        .team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .agent-card { background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .agent-card h2 { font-family: 'Roboto', sans-serif; font-weight: 700; color: var(--text-color); margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; font-size: 1.2rem; }
        .agreements-section h3, .solutions-section h3 { color: var(--secondary-color); font-size: 1rem; text-transform: uppercase; margin-bottom: 10px; font-weight: 700; }
        .agreements-list, .solutions-list { list-style: none; padding-left: 0; font-size: 0.9rem; flex-grow: 1; }
        .agreements-list li, .solutions-list li { background-color: #1A2D40; padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 3px solid var(--primary-color); display: flex; justify-content: space-between; align-items: center; gap: 10px; word-wrap: break-word; }
        .item-text { flex-grow: 1; }
        .no-items { color: #8b949e; font-style: italic; border-left-color: var(--border-color) !important; background-color: transparent !important; justify-content: flex-start; }
        .delete-btn { background-color: var(--danger-color); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; text-transform: uppercase; font-weight: bold; flex-shrink: 0; transition: background-color 0.2s ease; }
        .delete-btn:hover { background-color: #a35454; }
        .add-form { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-form textarea { width: 100%; padding: 10px; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); box-sizing: border-box; resize: vertical; }
        .add-form .add-btn { padding: 12px; background-color: var(--primary-color); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: background-color 0.3s ease; }
        .add-form .add-btn:hover { background-color: #006DC1; }
        footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); color: #8b949e; }
    </style>
</head>
<body>
    <header>
        <h1>Dashboard de <span>Acuerdos</span> Semanales</h1>
        <p>Equipo de Servicio al Cliente</p>
    </header>

    <main class="container">
        <div class="controls-container">
            <input type="text" id="search" placeholder="Buscar por nombre...">
            <button id="export-btn-csv" class="export-btn">Exportar a CSV</button>
        </div>

        <div id="team-grid" class="team-grid"></div>
    </main>

    <footer>
        <p>&copy; 2024 | Herramienta de Seguimiento para el Equipo</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const team = [
                "Gabriela Latorre Mojica", "Gian Paol Munoz Hincapie", "Jeimy Paola Velasquez", "Jhonhatan Alexander Alfonso",
                "Lina Maria Rico Bedoya", "Luisa Fernanda Garay Espitia", "Luna Angelica Martinez Garcia", "Nicoll Sofia Alonso Velasquez",
                "Oscar Daniel Salinas Almario", "Valeria Montanez Bustamante", "Paula Andrea Ballesteros Casallas"
            ];
            
            const teamGrid = document.getElementById('team-grid');
            const searchInput = document.getElementById('search');
            const exportBtnCsv = document.getElementById('export-btn-csv');

            const loadData = () => JSON.parse(localStorage.getItem('teamData')) || {};
            const saveData = (data) => localStorage.setItem('teamData', JSON.stringify(data));
            let teamData = loadData();

            // Lógica de renderizado y borrado (idéntica a la versión anterior)
            const renderCards = (filter = '') => {
                teamGrid.innerHTML = '';
                const filteredTeam = team.filter(name => name.toLowerCase().includes(filter.toLowerCase()));
                filteredTeam.forEach(name => {
                    if (!teamData[name]) teamData[name] = { agreements: [], solutions: [] };
                    const agentData = teamData[name];
                    const agreementsHtml = agentData.agreements.length > 0 ? agentData.agreements.map((item, index) => `<li><span class="item-text">${item}</span><button class="delete-btn" data-index="${index}" data-type="agreements">Borrar</button></li>`).join('') : '<li class="no-items">Sin acuerdos registrados.</li>';
                    const solutionsHtml = agentData.solutions.length > 0 ? agentData.solutions.map((item, index) => `<li><span class="item-text">${item}</span><button class="delete-btn" data-index="${index}" data-type="solutions">Borrar</button></li>`).join('') : '<li class="no-items">Sin soluciones propuestas.</li>';
                    const card = document.createElement('div');
                    card.className = 'agent-card';
                    card.setAttribute('data-name', name);
                    card.innerHTML = `<h2>${name}</h2><div class="agreements-section"><h3>Acuerdos</h3><ul class="agreements-list">${agreementsHtml}</ul></div><div class="solutions-section"><h3>Posibles Soluciones</h3><ul class="solutions-list">${solutionsHtml}</ul></div><div class="add-form"><textarea class="agreement-input" placeholder="Añadir nuevo acuerdo..." rows="2"></textarea><textarea class="solution-input" placeholder="Añadir posible solución..." rows="2"></textarea><button class="add-btn">Añadir</button></div>`;
                    teamGrid.appendChild(card);
                });
            };
            
            searchInput.addEventListener('input', () => renderCards(searchInput.value));

            teamGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.agent-card');
                if (!card) return;
                const agentName = card.getAttribute('data-name');
                if (e.target.classList.contains('add-btn')) {
                    const agreementInput = card.querySelector('.agreement-input');
                    const solutionInput = card.querySelector('.solution-input');
                    const newAgreement = agreementInput.value.trim();
                    const newSolution = solutionInput.value.trim();
                    if (newAgreement) teamData[agentName].agreements.push(newAgreement);
                    if (newSolution) teamData[agentName].solutions.push(newSolution);
                    if (newAgreement || newSolution) {
                        saveData(teamData);
                        renderCards(searchInput.value);
                    }
                }
                if (e.target.classList.contains('delete-btn')) {
                    const button = e.target;
                    const index = parseInt(button.dataset.index, 10);
                    const type = button.dataset.type;
                    teamData[agentName][type].splice(index, 1);
                    saveData(teamData);
                    renderCards(searchInput.value);
                }
            });

            // --- NUEVO: Lógica para exportar a CSV ---
            exportBtnCsv.addEventListener('click', () => {
                const allData = loadData();
                const rows = [
                    ['Agente', 'Tipo', 'Descripción'] // Encabezados del CSV
                ];

                Object.keys(allData).forEach(agentName => {
                    allData[agentName].agreements.forEach(agreement => {
                        // Para evitar problemas con comas en el texto, lo encerramos en comillas dobles
                        rows.push([`"${agentName}"`, '"Acuerdo"', `"${agreement.replace(/"/g, '""')}"`]);
                    });
                    allData[agentName].solutions.forEach(solution => {
                        rows.push([`"${agentName}"`, '"Solución"', `"${solution.replace(/"/g, '""')}"`]);
                    });
                });

                if (rows.length <= 1) {
                    alert("No hay datos para exportar.");
                    return;
                }

                // Convertir el array de filas a un string CSV
                let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");

                // Crear un enlace y simular un clic para descargar el archivo
                var encodedUri = encodeURI(csvContent);
                var link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "reporte_de_acuerdos.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });

            renderCards();
        });
    </script>
</body>
</html>
