<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Acuerdos | Servicio al Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #004E98; --secondary-color: #FFB703; --danger-color: #8a3d3d; --success-color: #2a9d8f; --background-color: #0A1929; --card-background: #112233; --text-color: #E0E0E0; --border-color: #303E4D; }
        body { background-color: var(--background-color); color: var(--text-color); font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; min-height: 100vh; box-sizing: border-box; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        header h1 { font-family: 'Orbitron', sans-serif; color: var(--text-color); font-size: 2.5rem; }
        header h1 span { color: var(--primary-color); text-shadow: 0 0 8px rgba(0, 78, 152, 0.7); }
        .container { width: 90%; max-width: 1400px; margin: 0 auto; flex: 1; }
        .controls-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        #search { width: 100%; max-width: 500px; padding: 15px; background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); font-size: 1rem; outline: none; transition: all 0.3s ease; }
        #search:focus { border-color: var(--secondary-color); box-shadow: 0 0 15px rgba(255, 183, 3, 0.3); }
        .export-btn { padding: 15px 25px; background-color: var(--secondary-color); color: var(--background-color); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: all 0.3s ease; min-width: 240px; text-align: center; }
        .export-btn:hover { background-color: #ffca43; transform: translateY(-2px); }
        .export-btn:disabled { background-color: #555; color: #aaa; cursor: not-allowed; transform: none; }
        .export-btn.success { background-color: var(--success-color); color: white; }
        .team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .agent-card { background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .agent-card h2 { font-family: 'Roboto', sans-serif; font-weight: 700; color: var(--text-color); margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; font-size: 1.2rem; }
        .agreements-section h3, .solutions-section h3 { color: var(--secondary-color); font-size: 1rem; text-transform: uppercase; margin-bottom: 10px; font-weight: 700; }
        
        /* --- AJUSTES EN LA TABLA --- */
        .agent-card table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: 10px;
            table-layout: fixed; /* <-- 1. AÑADIDO: Estabiliza el layout de la tabla */
        }
        
        .agent-card th { color: var(--secondary-color); text-align: left; font-size: 0.8rem; text-transform: uppercase; padding: 0 10px 5px; border-bottom: 1px solid var(--border-color); }
        .agent-card td { background-color: #1A2D40; padding: 12px; font-size: 0.9rem; vertical-align: middle; }
        
        /* --- AJUSTES EN LA CELDA DE TEXTO --- */
        .agent-card td:first-child {
            border-left: 3px solid var(--primary-color);
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            width: 100%;
            word-break: break-all; /* <-- 2. AÑADIDO: Fuerza el salto de línea en textos largos */
        }
        
        .agent-card td:last-child { border-top-right-radius: 5px; border-bottom-right-radius: 5px; }
        .action-cell { text-align: right; width: 1%; white-space: nowrap; }
        .no-items-row td { background-color: transparent !important; color: #8b949e; font-style: italic; border-left: 3px solid var(--border-color) !important; text-align: center; }
        .delete-btn { background-color: var(--danger-color); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; text-transform: uppercase; font-weight: bold; }
        .add-form { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-form textarea { width: 100%; padding: 10px; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); box-sizing: border-box; resize: vertical; }
        .add-form .add-btn { padding: 12px; background-color: var(--primary-color); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        .general-table-container { margin-top: 50px; padding-top: 30px; border-top: 1px solid var(--border-color); }
        .general-table-container h2 { text-align: center; font-family: 'Orbitron', sans-serif; margin-bottom: 20px; }
        #general-table { width: 100%; border-collapse: collapse; }
        #general-table th, #general-table td { padding: 12px 15px; border-bottom: 1px solid var(--border-color); text-align: left; vertical-align: top; }
        #general-table th { background-color: var(--card-background); color: var(--secondary-color); position: sticky; top: 0; z-index: 10; }
        #general-table tr:nth-child(even) { background-color: rgba(26, 45, 64, 0.5); }
        footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); color: #8b949e; }
    </style>
</head>
<body>
    <header><h1>Dashboard de <span>Acuerdos</span> Semanales</h1><p>Los Linineitors</p></header>
    <main class="container">
        <div class="controls-container">
            <input type="text" id="search" placeholder="Buscar por nombre...">
            <button id="export-btn" class="export-btn">Exportar a Google Sheets</button>
        </div>
        <div id="team-grid" class="team-grid"></div>
        <div class="general-table-container">
            <h2>Tabla General de Registros</h2>
            <table id="general-table">
                <thead><tr><th>Nombre del agente</th><th>Acuerdo</th><th>Posible solucion</th></tr></thead>
                <tbody id="general-table-body"></tbody>
            </table>
        </div>
    </main>
    <footer><p>&copy; 2025 | Acuerdos Coaching Level Up - Los linineitors</p></footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const SCRIPT_URL = 'https://script.google.com/a/macros/mercadolibre.com.co/s/AKfycbxCV_ygI9LDwRObBFbFDCeP5pLAf8bbyz0QxHWAU_GWq-UFWrJrhQheFx2rhkpIq8L3/exec';
            const team = [ "Gabriela Latorre Mojica", "Gian Paol Munoz Hincapie", "Jeimy Paola Velasquez", "Jhonhatan Alexander Alfonso", "Lina Maria Rico Bedoya", "Luisa Fernanda Garay Espitia", "Luna Angelica Martinez Garcia", "Nicoll Sofia Alonso Velasquez", "Oscar Daniel Salinas Almario", "Valeria Montanez Bustamante", "Paula Andrea Ballesteros Casallas" ];
            const teamGrid = document.getElementById('team-grid');
            const searchInput = document.getElementById('search');
            const exportBtn = document.getElementById('export-btn');

            const loadData = () => JSON.parse(localStorage.getItem('teamData')) || {};
            const saveData = (data) => localStorage.setItem('teamData', JSON.stringify(data));
            let teamData = loadData();

            exportBtn.addEventListener('click', () => {
                const originalText = exportBtn.textContent;
                exportBtn.disabled = true;
                exportBtn.textContent = 'Exportando...';

                if (!SCRIPT_URL || SCRIPT_URL === 'PEGA_AQUÍ_LA_URL_DE_TU_SCRIPT') {
                    alert("Error: La URL del script de Google no ha sido configurada.");
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                    return;
                }

                const allData = loadData();
                const rowsToSend = [];
                
                team.forEach(agentName => {
                    const agentData = allData[agentName];
                    if (agentData && (agentData.agreements.length > 0 || agentData.solutions.length > 0)) {
                        const agreementsText = agentData.agreements.map(item => item.text).join('\n');
                        const solutionsText = agentData.solutions.map(item => item.text).join('\n');
                        
                        rowsToSend.push({
                            agent: agentName,
                            agreements: agreementsText,
                            solutions: solutionsText
                        });
                    }
                });
                
                if (rowsToSend.length === 0) {
                    alert("No hay datos para exportar.");
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                    return;
                }

                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ rows: rowsToSend })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.result === "success") {
                        exportBtn.textContent = '¡Exportado con Éxito!';
                        exportBtn.classList.add('success');
                        setTimeout(() => {
                            exportBtn.disabled = false;
                            exportBtn.textContent = originalText;
                            exportBtn.classList.remove('success');
                        }, 2500);
                    } else { throw new Error(data.error || 'Error desconocido.'); }
                })
                .catch(error => {
                    console.error('Error al exportar:', error);
                    alert('Hubo un error al exportar. Revisa la consola (F12).');
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                });
            });

            const renderGeneralTableFn = () => {
                const tableBody = document.getElementById('general-table-body');
                tableBody.innerHTML = '';
                const allData = loadData();
                let hasAnyEntry = false;
                team.forEach(agentName => {
                    const agentData = allData[agentName];
                    if (agentData && (agentData.agreements.length > 0 || agentData.solutions.length > 0)) {
                        hasAnyEntry = true;
                        const agreementsHtml = agentData.agreements.map(item => item.text).join('<br>');
                        const solutionsHtml = agentData.solutions.map(item => item.text).join('<br>');
                        const row = `<tr><td>${agentName}</td><td>${agreementsHtml}</td><td>${solutionsHtml}</td></tr>`;
                        tableBody.innerHTML += row;
                    }
                });
                if (!hasAnyEntry) { tableBody.innerHTML = '<tr><td colspan="3" style="text-align: center; font-style: italic;">No hay registros para mostrar.</td></tr>'; }
            };
            const renderCardsFn = (filter = '') => {
                teamGrid.innerHTML = '';
                const filteredTeam = team.filter(name => name.toLowerCase().includes(filter.toLowerCase()));
                filteredTeam.forEach(name => {
                    if (!teamData[name]) teamData[name] = { agreements: [], solutions: [] };
                    const agentData = teamData[name];
                    const agreementsRowsHtml = agentData.agreements.length > 0 ? agentData.agreements.map((item, index) => `<tr><td>${item.text}</td><td class="action-cell"><button class="delete-btn" data-index="${index}" data-type="agreements">Borrar</button></td></tr>`).join('') : '<tr class="no-items-row"><td colspan="2">Sin acuerdos registrados.</td></tr>';
                    const solutionsRowsHtml = agentData.solutions.length > 0 ? agentData.solutions.map((item, index) => `<tr><td>${item.text}</td><td class="action-cell"><button class="delete-btn" data-index="${index}" data-type="solutions">Borrar</button></td></tr>`).join('') : '<tr class="no-items-row"><td colspan="2">Sin soluciones propuestas.</td></tr>';
                    const card = document.createElement('div');
                    card.className = 'agent-card';
                    card.setAttribute('data-name', name);
                    card.innerHTML = `<h2>${name}</h2><div class="agreements-section"><h3>Acuerdos</h3><table><thead><tr><th>Descripción</th><th>Acción</th></tr></thead><tbody>${agreementsRowsHtml}</tbody></table></div><div class="solutions-section"><h3>Posibles Soluciones</h3><table><thead><tr><th>Descripción</th><th>Acción</th></tr></thead><tbody>${solutionsRowsHtml}</tbody></table></div><div class="add-form"><textarea class="agreement-input" placeholder="Añadir nuevo acuerdo..." rows="2"></textarea><textarea class="solution-input" placeholder="Añadir posible solución..." rows="2"></textarea><button class="add-btn">Añadir</button></div>`;
                    teamGrid.appendChild(card);
                });
                renderGeneralTableFn();
            };
            searchInput.addEventListener('input', () => renderCardsFn(searchInput.value));
            teamGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.agent-card');
                if (!card) return;
                const agentName = card.getAttribute('data-name');
                if (e.target.classList.contains('add-btn')) {
                    const agreementInput = card.querySelector('.agreement-input');
                    const solutionInput = card.querySelector('.solution-input');
                    const newAgreement = agreementInput.value.trim();
                    const newSolution = solutionInput.value.trim();
                    const entryDate = new Date().toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    if (newAgreement) { teamData[agentName].agreements.push({ text: newAgreement, date: entryDate }); }
                    if (newSolution) { teamData[agentName].solutions.push({ text: newSolution, date: entryDate }); }
                    if (newAgreement || newSolution) { saveData(teamData); renderCardsFn(searchInput.value); }
                }
                if (e.target.classList.contains('delete-btn')) {
                    const button = e.target;
                    const index = parseInt(button.dataset.index, 10);
                    const type = button.dataset.type;
                    teamData[agentName][type].splice(index, 1);
                    saveData(teamData);
                    renderCardsFn(searchInput.value);
                }
            });
            renderCardsFn();
        });
    </script>
</body>
</html>
