<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Acuerdos | Servicio al Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #004E98; --secondary-color: #FFB703; --danger-color: #8a3d3d; --success-color: #2a9d8f; --background-color: #0A1929; --card-background: #112233; --text-color: #E0E0E0; --border-color: #303E4D; }
        body { background-color: var(--background-color); color: var(--text-color); font-family: 'Roboto', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; min-height: 100vh; box-sizing: border-box; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        header h1 { font-family: 'Orbitron', sans-serif; color: var(--text-color); font-size: 2.5rem; }
        header h1 span { color: var(--primary-color); text-shadow: 0 0 8px rgba(0, 78, 152, 0.7); }
        .container { width: 90%; max-width: 1400px; margin: 0 auto; flex: 1; }
        .controls-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
        #search { width: 100%; max-width: 500px; padding: 15px; background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); font-size: 1rem; outline: none; transition: all 0.3s ease; }
        #search:focus { border-color: var(--secondary-color); box-shadow: 0 0 15px rgba(255, 183, 3, 0.3); }
        .export-btn { padding: 15px 25px; background-color: var(--secondary-color); color: var(--background-color); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: all 0.3s ease; min-width: 240px; text-align: center; }
        .export-btn:hover { background-color: #ffca43; transform: translateY(-2px); }
        .export-btn:disabled { background-color: #555; color: #aaa; cursor: not-allowed; transform: none; }
        .export-btn.success { background-color: var(--success-color); color: white; }
        .team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .agent-card { background-color: var(--card-background); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .agent-card:hover { transform: translateY(-5px); border-color: var(--primary-color); }
        .agent-card h2 { font-family: 'Roboto', sans-serif; font-weight: 700; color: var(--text-color); margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; font-size: 1.2rem; }
        .agreements-section h3, .solutions-section h3 { color: var(--secondary-color); font-size: 1rem; text-transform: uppercase; margin-bottom: 10px; font-weight: 700; }
        .agreements-list, .solutions-list { list-style: none; padding-left: 0; font-size: 0.9rem; flex-grow: 1; }
        .agreements-list li, .solutions-list li { background-color: #1A2D40; padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 3px solid var(--primary-color); display: flex; justify-content: space-between; align-items: center; gap: 10px; word-wrap: break-word; }
        .item-text { flex-grow: 1; }
        .no-items { color: #8b949e; font-style: italic; border-left-color: var(--border-color) !important; background-color: transparent !important; justify-content: flex-start; }
        .delete-btn { background-color: var(--danger-color); color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 0.7rem; cursor: pointer; text-transform: uppercase; font-weight: bold; flex-shrink: 0; transition: background-color 0.2s ease; }
        .delete-btn:hover { background-color: #a35454; }
        .add-form { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-form textarea { width: 100%; padding: 10px; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); box-sizing: border-box; resize: vertical; }
        .add-form .add-btn { padding: 12px; background-color: var(--primary-color); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: background-color 0.3s ease; }
        .add-form .add-btn:hover { background-color: #006DC1; }
        footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color); color: #8b949e; }
    </style>
</head>
<body>
    <header>
        <h1>Dashboard de <span>Acuerdos</span> Semanales</h1>
        <p>Equipo de Servicio al Cliente</p>
    </header>

    <main class="container">
        <div class="controls-container">
            <input type="text" id="search" placeholder="Buscar por nombre...">
            <button id="export-btn" class="export-btn">Exportar a Google Sheets</button>
        </div>

        <div id="team-grid" class="team-grid"></div>
    </main>

    <footer>
        <p>&copy; 2024 | Herramienta de Seguimiento para el Equipo</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ¡IMPORTANTE! Pega aquí la URL que copiaste en el Paso 3 ---
            const SCRIPT_URL = 'https://script.google.com/a/macros/mercadolibre.com.co/s/AKfycbyPEAtzPmpVPAGcUgBApRFng24ChM-Nk_1cCbiWEDNazw46iZzONmi0M_IEI0OcnSCd/exec';

            const team = [ "Gabriela Latorre Mojica", "Gian Paol Munoz Hincapie", "Jeimy Paola Velasquez", "Jhonhatan Alexander Alfonso", "Lina Maria Rico Bedoya", "Luisa Fernanda Garay Espitia", "Luna Angelica Martinez Garcia", "Nicoll Sofia Alonso Velasquez", "Oscar Daniel Salinas Almario", "Valeria Montanez Bustamante", "Paula Andrea Ballesteros Casallas" ];
            const teamGrid = document.getElementById('team-grid');
            const searchInput = document.getElementById('search');
            const exportBtn = document.getElementById('export-btn');

            const loadData = () => JSON.parse(localStorage.getItem('teamData')) || {};
            const saveData = (data) => localStorage.setItem('teamData', JSON.stringify(data));
            let teamData = loadData();

            const renderCards = (filter = '') => { /* ...Código de renderizado sin cambios... */ };
            // Copia la función renderCards y el event listener de teamGrid de tu código anterior aquí.
            // Los incluyo de nuevo al final para que sea más fácil.

            // --- Lógica para Exportar a Google Sheets ---
            exportBtn.addEventListener('click', () => {
                const originalText = exportBtn.textContent;
                exportBtn.disabled = true;
                exportBtn.textContent = 'Exportando...';

                if (SCRIPT_URL === 'PEGA_AQUÍ_LA_URL_DE_TU_SCRIPT' || !SCRIPT_URL) {
                    alert("Error de configuración: La URL del script de Google no ha sido añadida al código JavaScript.");
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                    return;
                }
                
                const allData = loadData();
                const rows = [];
                Object.keys(allData).forEach(agentName => {
                    allData[agentName].agreements.forEach(agreement => {
                        rows.push([agentName, 'Acuerdo', agreement]);
                    });
                    allData[agentName].solutions.forEach(solution => {
                        rows.push([agentName, 'Solución', solution]);
                    });
                });

                if (rows.length === 0) {
                    alert("No hay datos para exportar.");
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                    return;
                }

                // Usamos fetch para enviar los datos al script de Google
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    // mode: 'no-cors' // a veces es necesario, pero postData lo maneja bien
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ rows: rows })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.result === "success") {
                        exportBtn.textContent = '¡Exportado con Éxito!';
                        exportBtn.classList.add('success');
                        setTimeout(() => {
                            exportBtn.disabled = false;
                            exportBtn.textContent = originalText;
                            exportBtn.classList.remove('success');
                        }, 2500);
                    } else {
                        throw new Error(data.error || 'Error desconocido en el script.');
                    }
                })
                .catch(error => {
                    console.error('Error al exportar:', error);
                    alert('Hubo un error al exportar los datos. Revisa la consola (F12) para más detalles.');
                    exportBtn.disabled = false;
                    exportBtn.textContent = originalText;
                });
            });


            // --- Aquí están las funciones de renderizado y eventos para copiar y pegar ---
            const renderCardsFn = (filter = '') => {
                teamGrid.innerHTML = '';
                const filteredTeam = team.filter(name => name.toLowerCase().includes(filter.toLowerCase()));
                filteredTeam.forEach(name => {
                    if (!teamData[name]) teamData[name] = { agreements: [], solutions: [] };
                    const agentData = teamData[name];
                    const agreementsHtml = agentData.agreements.length > 0 ? agentData.agreements.map((item, index) => `<li><span class="item-text">${item}</span><button class="delete-btn" data-index="${index}" data-type="agreements">Borrar</button></li>`).join('') : '<li class="no-items">Sin acuerdos registrados.</li>';
                    const solutionsHtml = agentData.solutions.length > 0 ? agentData.solutions.map((item, index) => `<li><span class="item-text">${item}</span><button class="delete-btn" data-index="${index}" data-type="solutions">Borrar</button></li>`).join('') : '<li class="no-items">Sin soluciones propuestas.</li>';
                    const card = document.createElement('div');
                    card.className = 'agent-card';
                    card.setAttribute('data-name', name);
                    card.innerHTML = `<h2>${name}</h2><div class="agreements-section"><h3>Acuerdos</h3><ul class="agreements-list">${agreementsHtml}</ul></div><div class="solutions-section"><h3>Posibles Soluciones</h3><ul class="solutions-list">${solutionsHtml}</ul></div><div class="add-form"><textarea class="agreement-input" placeholder="Añadir nuevo acuerdo..." rows="2"></textarea><textarea class="solution-input" placeholder="Añadir posible solución..." rows="2"></textarea><button class="add-btn">Añadir</button></div>`;
                    teamGrid.appendChild(card);
                });
            };
            
            teamGrid.addEventListener('click', (e) => {
                const card = e.target.closest('.agent-card');
                if (!card) return;
                const agentName = card.getAttribute('data-name');
                if (e.target.classList.contains('add-btn')) {
                    const agreementInput = card.querySelector('.agreement-input');
                    const solutionInput = card.querySelector('.solution-input');
                    const newAgreement = agreementInput.value.trim();
                    const newSolution = solutionInput.value.trim();
                    if (newAgreement) teamData[agentName].agreements.push(newAgreement);
                    if (newSolution) teamData[agentName].solutions.push(newSolution);
                    if (newAgreement || newSolution) {
                        saveData(teamData);
                        renderCardsFn(searchInput.value);
                    }
                }
                if (e.target.classList.contains('delete-btn')) {
                    const button = e.target;
                    const index = parseInt(button.dataset.index, 10);
                    const type = button.dataset.type;
                    teamData[agentName][type].splice(index, 1);
                    saveData(teamData);
                    renderCardsFn(searchInput.value);
                }
            });

            // Llamada inicial
            renderCardsFn();
        });
    </script>
</body>
</html>
